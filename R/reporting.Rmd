---
title: "Avancée du travail"
date: Mis à jour le \today
lang: fr
fontsize: 12pt
output:
  pdf_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=4, fig.height=3.6, fig.path='Figs/',
                      echo=F, warning=FALSE, message=FALSE, fig.align="center")
```
```{r, loading_data, echo=FALSE}
library(tidyverse)
library(stringi)

source("load_data.R")

data_full <- read.csv("data/generated/BDD_full_dirty.csv", stringsAsFactors = FALSE)
data_sub  <- read.csv("data/generated/BDD_sub.csv", stringsAsFactors = FALSE)

```

## Exploration des valeurs

Sur les données pour lesquelles les relevés de flore sont présents :

- Années de l'enquête : 2007 et 2011
- Nom enquêteurs : `Inchausti` et `Grison`

```{r, data_summary, echo=F}
data_sub %>%
  filter(!is.na(qtx_ha), Type_CultureSimplifiée != "autre") %>%
  group_by(Type_CultureSimplifiée) %>%
  summarise(n_plots = length(unique(id_parc_tri)),
            n_years = length(unique(Année_SuiviParcelle))) %>%
  arrange(desc(n_plots)) %>%
  knitr::kable()
```

### Données de fertilisation

Il manque beaucoup de valeurs pour l'analyse de la fertilisation.
J'ai effectué la conversion des doses en "Kg/HA" pour les produits présents dans
le tableau de référence (3 produits).
Cela ne laisse donc pas beaucoup de points pour le moment :

```{r, data_summary_ferti, echo=F}
data_sub %>%
  filter(!is.na(kg_n_ha), !is.na(qtx_ha),
         Type_CultureSimplifiée != "autre") %>%
  group_by(Type_CultureSimplifiée) %>%
  summarise(n = length(unique(id_parc_tri))) %>%
  knitr::kable()
```

J'ai commencé à regarder les valeurs pour le blé et le maïs, qui sont les
cultures les plus représentées.

J'ai regardé dans la base de données de Robin, il y a une colonne `Kg.N.ha`.
Il n'y a pas les calculs pour cette colonne dans ses scripts, mais il indique
dans son rapport qu'il l'a calculée à partir des concentrations des produits sur
les sites des revendeurs.

#### Pour le blé
```{r graphique_ble, echo=F}
# graphiques
# ble
data_sub %>%
  filter(!is.na(kg_n_ha), Type_CultureSimplifiée == "ble",
         !is.na(qtx_ha)) %>%
  ggplot(aes(x = kg_n_ha, y = qtx_ha)) + geom_point(size = 2) +
  theme(axis.title = element_text(size = 17),
        axis.text = element_text(size = 17))
```
```{r graphique_ble2, echo=F}
data_sub %>%
  filter(!is.na(dose_n), Type_CultureSimplifiée == "ble",
         !is.na(qtx_ha)) %>%
  ggplot(aes(x = dose_n, y = qtx_ha)) + geom_point(size = 2) +
  theme(axis.title = element_text(size = 17),
        axis.text = element_text(size = 17))
```

```{r graphique_mais, echo=F}
# graphiques
# ble
data_sub %>%
  filter(!is.na(kg_n_ha), Type_CultureSimplifiée == "mais",
         !is.na(qtx_ha)) %>%
  ggplot(aes(x = kg_n_ha, y = qtx_ha)) + geom_point(size = 2) +
  theme(axis.title = element_text(size = 17),
        axis.text = element_text(size = 17))
```
```{r graphique_mais2, echo=F}
# mais
data_sub %>%
  filter(!is.na(dose_n), Type_CultureSimplifiée == "mais",
         !is.na(qtx_ha)) %>%
  ggplot(aes(x = dose_n, y = qtx_ha)) +
  geom_point(size = 2) +
  theme(axis.title = element_text(size = 17),
        axis.text = element_text(size = 17))
```
