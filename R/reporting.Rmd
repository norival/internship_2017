---
title: "Compte rendu"
date: Mis à jour le \today
lang: fr
fontsize: 12pt
output:
  pdf_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=4, fig.height=4, fig.path='Figs/',
                      echo=TRUE, warning=FALSE, message=FALSE)
```

## Groupement des communautés adventices

```{r, loading_data_lda, echo=FALSE}
load("/tmp/datlda.RData")
```

La fonction `LDA` nécessite d'avoir une matrice de nombres entiers.
J'ai donc arrondi les valeurs d'estimations à l'entier supérieur.

```{r, models, echo=T}
seed    <- "42"
ngroups <- 5
mod     <- LDA(x = dat, k = ngroups, control = list(seed = seed))
```

On peut observer la distribution des groupes et des espèces (pas très
informatif) :

```{r, groupes, echo=F,fig.width=7}
# get the posterior probabilities from the model
post <- posterior(mod)

# tidy the post datasets into a form easily 'plotable'
tidy_post <- tidy_lda_post(post)

tidy_post$plots %>%
  ggplot(aes(x = x, y = val, colour = gp)) +
  geom_line() +
  xlab("Parcelles") +
  ylab("Pourcentage d'appartenance") +
  theme_bw()
```

Voila ce que ça donne sur les 5 premières parcelles seulement :

```{r, groupes5, echo=F,fig.width=7}
plots <- tidy_post$plots
parc <- unique(plots$parc)[1:5]

plots[plots$parc %in% parc,] %>%
  ggplot(aes(x = x, y = val, colour = gp)) +
  geom_line() +
  xlab("Parcelles") +
  ylab("Pourcentage d'appartenance") +
  scale_x_continuous(labels=parc) +
  theme_bw()
```

On peut avoir l'abondance relative de chaque espèce au sein des groupes :

```{r, spp, echo=F,fig.width=7,fig.height=5}
ggplot(tidy_post$spp, aes(x = x, y = rel_ab, colour = gp)) +
  geom_line() +
  xlab("Espèces") +
  ylab("Abondance relative au sein des groupes") +
  facet_grid(gp ~ .) +
  theme_bw()
```

```{r, topics, echo=TRUE}
# 5 espèces les plus abondantes pour chaque groupe:
terms(mod, 5)
```

```{r, mostliktopics, echo=T}
# groupe le plus vraissemblable pour la parcelle '10397-6998-Pa':
topics(mod)['10397-6998-Pa']
```
