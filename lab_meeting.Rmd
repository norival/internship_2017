---
title: "Lab meeting"
date: March 31, 2017
author: Xavier Laviron
output: ioslides_presentation
---

```{r, loading_data, echo=FALSE}
load('/tmp/data_flore.RData')
```

## Diferent types of sampling

- Sampling present/absent (0/1)
- Sampling $log_2$:
    - 0 = 0 plant
    - 1 = 1 plant
    - 2 = > 1 plant
- Sampling $log_{10}$:
    - 0 = 0 plant
    - 1 = 1 plant
    - 2 = [2; 9] plants
    - 3 = [10; 99] plants
    - 4 = [100; 999] plants
    - 5 = [1000; 9999] plants

## Méthode d'estimation

- Estimation de l'abondance réelle en supposant que la distribution des
  abondances suit une loi de Poisson :

\[
P(X=k) = \frac{\lambda^{k}}{k!}\times e^{-\lambda}
\]

- On cherche donc le paramètre $\lambda$ de la loi tel que $P$ est maximum, $P$
  étant la probabilité d'observer les données $k$
- Répété sur chaque espèce et pour chaque parcelle

## Vérifications

- Vérification sur les données 2014

```{r, graph5, echo=FALSE}
load('/tmp/data_verif.RData')
dat_noinf <- dat[!(is.infinite(dat$estimate)),]

f_labels <- aggregate(data.frame(r2 = dat$r2, eqn = dat$eqn),
                      list(periode = dat$periode, base = dat$base),
                      unique)
f_labels$r2 <- paste("R2=", round(f_labels$r2, 3), sep = "")

p <- ggplot(dat, aes(x = real, y = estimate)) +
  geom_point(size = 1) +
  geom_abline(slope = 1, intercept = 0) +
  xlim(0, 40) +
  ylim(0, 40) +
  xlab("Valeurs observées") +
  ylab("Valeurs estimées") +
  facet_grid(periode ~ base) +
  geom_text(x = 32, y = 20, aes(label = eqn), data = f_labels,
            colour = "red", fontface = "bold") +
  geom_text(x = 32, y = 15, aes(label = r2), data = f_labels,
            colour = "red", fontface = "bold")
suppressWarnings(plot(p))
```

## Résumé des parcelles
Il y a `r nrow(mat)` parcelles et `r ncol(mat)` espèces.

```{r, graph1, echo=FALSE}
sum_plots %>%
  ggplot(aes(x = year, y = n_plots)) +
  geom_bar(stat = 'identity')
```

## Richesse moyenne par parcelle

```{r, graph2, echo=FALSE}
sum_plots %>%
  ggplot(aes(x = year, y = n_sp_pplot)) +
  geom_bar(stat = "identity")
```

## Abondance moyenne par parcelle

```{r, graph3, echo=FALSE}
sum_plots %>%
  ggplot(aes(x = year, y = mab_pplot)) +
  geom_bar(stat = "identity")
```

## Espèces les plus fréquentes


```{r, tab1, echo=FALSE}
aa <- sum_flora[order(sum_flora$occurence, decreasing = T),]
aa %>%
  head(6) %>%
  mutate_if(is.numeric, round) %>%
  knitr::kable(format="markdown")
```

## Espèces les plus fréquentes

```{r, graph4, echo=FALSE}
tabtot %>%
  ggplot(aes(x = year, y = ab)) +
  geom_line() +
  facet_wrap(~ sp)
```
